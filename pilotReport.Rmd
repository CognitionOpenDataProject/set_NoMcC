---
title: "COD Reproducibility Report"
output:
  html_document:
    toc: true
    toc_float: true
---

#### Article ID: NoMcC
#### Pilot: Alicia Hofelich Mohr
#### Co-pilot: Tom Hardwicke  
#### Start date: 03-31-2017
#### End date: [Insert end date - use US format]   

-------

#### Methods summary: 
Researchers investigated the extent to which participants automatically imitate a heterosexual romantic partner versus a close friend of the same gender, and whether this imitation varies with levels of attachment anxiety or avoidance in each relationship (as assessed by an attachement questionnaire). Partners and friends were recorded performing mouth-opening movements, which were then presented to the participants as they were also instructed to either perform congruent or incongruent mouth-opening actions. Latency to perform the movement was measured using electromyographic (EMG) recordings of the Obicularis Oris. 

The extent to which latency was affected by congruency of stimulus, type of partner (platonic versus romantic) and attachement style was tested. 

It appears that two participants were removed for having attachment scores over two SD of the group mean (IDs 5 and 7). These ids are missing from the dataset, so there is no way to confirm this statement. The raw EMG data is also missing and latency appears to be captured in the variable "LENGTH", although the lack of metadata included with the labels makes this difficult to confirm. 

------

#### Target outcomes: 

> First, scores reflecting attachment-related anxiety (ANX) and avoidance (AVO) were extracted for both the romantic and the platonic relationship, for each participant (following Fraley et al., 2000). Two participants were excluded for having scores >±2SD from the group mean, leaving 19 participants for final analysis. Mean ANX scores did not significantly differ between relationship types, M(romantic) = 1.75, 95% CI[1.14, 2.36], M(platonic) = 1.95 95% CI[1.41, 2.48], t(18) = 0.64, p > 0.250. However there was a significant difference in AVO scores, M(romantic) = 1.20, 95% CI[0.75, 1.65], M(platonic) = 3.11, 95% CI[2.33, 3.90], t(18) = 5.28, p < 0.001, d = 1.44. There were no gender differences in any of the attachment scores (all p-values > 0.11).

> To obtain a broad understanding of automatic imitation of partners and friends before attachment was considered, we first carried out a basic repeated-measures ANOVA with two within-subjects factors, Congruency (congruent vs. incongruent) and Relationship (platonic vs. romantic). This revealed an expected large main effect of Congruency, F(1, 18) = 91.8, p < 0.001, whereby participants were significantly faster to respond to congruent trials, M = 390 ms, 95% CI[333, 447], than incongruent trials, M = 465 ms, 95% CI[402, 529]. Importantly, this effect was significantly moderated by Relationship, F(1, 18) = 14.96, p = 0.001. Paired t-tests revealed that participants were faster to respond to their partner than their friend on congruent trials, MPARTNER = 378 ms, MFRIEND = 400 ms, t(18) = 2.70, p = 0.015, and slower to respond to their partner compared to their friend on incongruent trials, MPARTNER = 476 ms, MFRIEND = 454 ms, t(18) = 1.89, p = 0.075. The absolute difference in RT between trials featuring the partner and the friend did not significantly differ for congruent vs. incongruent conditions, MCONG = 34.3 ms, MINCONG = 38.1 ms, t(18) = 0.36, p = 0.725. This suggested that the effects of Relationship were observed relatively equally in both congruent and incongruent trials.

> Next, adult attachment scores were added to the analyses to investigate how these were related to automatic imitation. As each participant had four separate scores indicating their attachment to their partner and to their friend, a linear mixed effects model was deemed a suitable alternative to standard repeated-measures ANCOVA as it allows for covariates that differ for different levels of the repeated factor. The dependent variable was the congruency effect (CE), calculated by subtracting the mean RT for incongruent trials from those for congruent trials, for ‘partner’ and ‘friend’ separately. Using GENLINMIXED in SPSS 21, a fully-factorial model was fitted with one within-subjects categorical predictor, Relationship (platonic vs. romantic), and two standardised continuous between-subjects predictors, ANX and AVO. A random factor, representing the intercept for each participant, was also entered, to take into account the within-subjects nature of the data.

> This model was a significant fit for the data, F(7, 30) = 19.25, p < 0.001. Inspection of the model parameters revealed a main effect of Relationship, F(1, 30) = 4.40, p = 0.044, whereby individuals showed significantly greater mimicry of their partners than they did their friends, controlling for differences in ANX and AVO attachment style (see Fig. 2).

> This effect was significantly moderated by ANX, F(1, 30) = 9.25, p = 0.005, whereby ANX had a significantly different effect on mimicry of partners compared to friends. For the partner, the parameter estimate of the effect of ANX on mimicry was positive, M = 19 ms, 95% CI[−1, 40], p = 0.064, and for the friend was negative, M = −15 ms, 95% CI[−26, −4], p = 0.012. In contrast, there was no significant main effect of AVO attachment style, F(1, 30) = 0.57, p = 0.456, nor did it interact with Relationship, F(1, 30) = 0.51, p = 0.479. These findings are summarised in Fig. 3.


------


```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

## Step 1: Load packages

Unable to install CODreports. 

```{r}
library(tidyverse) # for data munging
library(knitr) # for kable table formating
library(haven) # import and export 'SPSS', 'Stata' and 'SAS' Files
library(readxl) # import excel files
library(devtools)
install_github("CODreports", repo="CognitionOpenDataProject/CODreports")
library(CODreports) # custom report functions
library(nlme) #for mixed linear model, most similar output to SPSS
```

## Step 2: Load data

```{r}
dataset1 = read_excel(path="data/data.xlsx", sheet = 1)
dataset2 = read_excel(path="data/data.xlsx", sheet = 2)
```

## Step 3: Tidy data

While dataset1 seems "tidy" the lack of any usable metadata makes it very difficult to know which columns contain which pieces of data, and what the values within columns represent. 
```{r}
head(dataset1)
summary(dataset1)
```


Id1 and couple_ID have a 1:1 relationship, so unclear what the difference between those to variables is. 
```{r}
table(dataset1$id1, dataset1$couple_ID)
```


Since each line with the same id1 value and different "VID_FACE" values have different attachment score values (AVO and ANX), this must be partner/friend rather than congruent/incongruent. Unclear which is 1 and which is 2.  
```{r}
by(dataset1$AVO, dataset1$VID_FACE, summary)
by(dataset1$ANX, dataset1$VID_FACE, summary)
```
Based on the means and description from the results, romantic partner must be 1 and friend 2. 

No idea what Baseline_M is. 

Dataset2 needs to be reshaped in order to run the tests described. 
```{r}
#add ID variable (1-21, missing 5 and 7 - have to assume they are in the same order... )
dataset2$ID = c(1:4, 6, 8:21)
dataset2.long = gather(dataset2, key=type, value=mean_latency, M_CONG_P:M_INCONG_F)
dataset2.long$congruency = gsub("M_|_P|_F", "", dataset2.long$type)
dataset2.long$relationship = gsub("M_CONG_|M_INCONG_", "", dataset2.long$type)
```


## Step 4: Run analysis

### Descriptive statistics

> Two participants were excluded for having scores >±2SD from the group mean, leaving 19 participants for final analysis.

It appears that participants with IDs 5 and 7 are not included in the data, so it is assumed those participants were removed. There are indeed 19 participants in the data. 

```{r}
levels(factor(dataset1$id1))
length(levels(factor(dataset1$id1)))
```
 
> Mean ANX scores did not significantly differ between relationship types, M(romantic) = 1.75, 95% CI[1.14, 2.36], M(platonic) = 1.95 95% CI[1.41, 2.48], t(18) = 0.64, p > 0.250. 

```{r}
kable(dataset1 %>%
  group_by(VID_FACE) %>%
  summarize(mean_ANX = mean(ANX), sd_ANX=sd(ANX), hci = (mean(ANX) + 2.10*(sd(ANX)/sqrt(19))), lci = (mean(ANX) - 2.10*(sd(ANX)/sqrt(19)))), digits=2, col.names = c("Relationship", "Mean", "SD", "High 95 CI", "Low 95 CI"), caption="ANX tests")

t.test(ANX ~ VID_FACE, data=dataset1, paired=T)
```



> However there was a significant difference in AVO scores, M(romantic) = 1.20, 95% CI[0.75, 1.65], M(platonic) = 3.11, 95% CI[2.33, 3.90], t(18) = 5.28, p < 0.001, d = 1.44. 

```{r}
kable(dataset1 %>%
  group_by(VID_FACE) %>%
  summarize(mean_AVO = mean(AVO), sd_AVO=sd(AVO), hci = (mean(AVO) + 2.10*(sd(AVO)/sqrt(19))), lci = (mean(AVO) - 2.10*(sd(AVO)/sqrt(19)))), digits=2, col.names = c("Relationship", "Mean", "SD", "High 95 CI", "Low 95 CI"), caption="AVO tests")

t.test(AVO ~ VID_FACE, data=dataset1, paired=T)
```


> There were no gender differences in any of the attachment scores (all p-values > 0.11).

Unclear what test they used - probably a t-test? Separate t-tests for each test/relationship?
```{r}
t.test(AVO ~ gender, data=subset(dataset1, dataset1$VID_FACE==1), paired=FALSE)
t.test(AVO ~ gender, data=subset(dataset1, dataset1$VID_FACE==2), paired=FALSE)
t.test(ANX ~ gender, data=subset(dataset1, dataset1$VID_FACE==1), paired=FALSE)
t.test(ANX ~ gender, data=subset(dataset1, dataset1$VID_FACE==2), paired=FALSE)
```

Yes, the separate t-tests seem to match the results they report. 

Although if done in an ANOVA, the descrepency is much larger. 
```{r}
summary(aov(AVO ~ gender + Error(factor(id1)), data=dataset1))
summary(aov(ANX ~ gender + Error(factor(id1)), data=dataset1))
```


### Inferential statistics

> To obtain a broad understanding of automatic imitation of partners and friends before attachment was considered, we first carried out a basic repeated-measures ANOVA with two within-subjects factors, Congruency (congruent vs. incongruent) and Relationship (platonic vs. romantic). This revealed an expected large main effect of Congruency, F(1, 18) = 91.8, p < 0.001, whereby participants were significantly faster to respond to congruent trials, M = 390 ms, 95% CI[333, 447], than incongruent trials, M = 465 ms, 95% CI[402, 529]. Importantly, this effect was significantly moderated by Relationship, F(1, 18) = 14.96, p = 0.001. 

```{r}
summary(aov(mean_latency ~ congruency*relationship + Error(factor(ID)/(congruency*relationship)), data=dataset2.long))
kable(dataset2.long %>%
  group_by(congruency) %>%
  summarize(mean = mean(mean_latency), sd=sd(mean_latency), hci = (mean(mean_latency) + 2.10*(sd(mean_latency)/sqrt(19))), lci = (mean(mean_latency) - 2.10*(sd(mean_latency)/sqrt(19)))),digits=2, col.names = c("Congruency", "Mean", "SD", "High 95 CI", "Low 95 CI"))
```
Slight rounding errors in incongruent latency CIs
```{r}
compareValues(reportedValue=529, obtainedValue = 529.5436)
compareValues(reportedValue=402, obtainedValue = 401.4274)
```

> Paired t-tests revealed that participants were faster to respond to their partner than their friend on congruent trials, MPARTNER = 378 ms, MFRIEND = 400 ms, t(18) = 2.70, p = 0.015, and slower to respond to their partner compared to their friend on incongruent trials, MPARTNER = 476 ms, MFRIEND = 454 ms, t(18) = 1.89, p = 0.075. 

```{r}
kable(dataset2.long %>%
        group_by(congruency, relationship) %>%
        summarize(mean=mean(mean_latency)))
t.test(mean_latency ~ relationship, data=subset(dataset2.long, dataset2.long$congruency=="CONG"), paired=T)
t.test(mean_latency ~ relationship, data=subset(dataset2.long, dataset2.long$congruency=="INCONG"), paired=T)


```
Again, minor rounding errors in the reported values. 
```{r}
compareValues(reportedValue = 378, obtainedValue = 378.8574)
compareValues(reportedValue = 400, obtainedValue = 400.5937)
compareValues(reportedValue = 454, obtainedValue = 454.4963)

```


> The absolute difference in RT between trials featuring the partner and the friend did not significantly differ for congruent vs. incongruent conditions, MCONG = 34.3 ms, MINCONG = 38.1 ms, t(18) = 0.36, p = 0.725. This suggested that the effects of Relationship were observed relatively equally in both congruent and incongruent trials.

Re-calcualte the difference scores
```{r}
dataset2$abspfdiff_cong = abs(dataset2$M_CONG_P - dataset2$M_CONG_F)
dataset2$abspfdiff_incong = abs(dataset2$M_INCONG_P - dataset2$M_INCONG_F)
```

Compare using a t.test
```{r}
t.test(dataset2$abspfdiff_cong, dataset2$abspfdiff_incong, var.equal = T, paired = T)
mean(dataset2$abspfdiff_cong)
mean(dataset2$abspfdiff_incong)
```

> Next, adult attachment scores were added to the analyses to investigate how these were related to automatic imitation. As each participant had four separate scores indicating their attachment to their partner and to their friend, a linear mixed effects model was deemed a suitable alternative to standard repeated-measures ANCOVA as it allows for covariates that differ for different levels of the repeated factor. The dependent variable was the congruency effect (CE), calculated by subtracting the mean RT for incongruent trials from those for congruent trials, for ‘partner’ and ‘friend’ separately. Using GENLINMIXED in SPSS 21, a fully-factorial model was fitted with one within-subjects categorical predictor, Relationship (platonic vs. romantic), and two standardised continuous between-subjects predictors, ANX and AVO. A random factor, representing the intercept for each participant, was also entered, to take into account the within-subjects nature of the data.

First, calculate congruency effect (CE). 
```{r}
#create a new dataset with "widened" cong/incong latency to create CE scores
dataset2.long = subset(dataset2.long, select=c("ID", "relationship", "congruency", "mean_latency"))
dataset3 = spread(dataset2.long, congruency, mean_latency, convert=T, drop=T)

#create CE scores (incongruent - congruent latency)
dataset3$CE = dataset3$INCONG - dataset3$CONG

#merge AVO and ANX data into this dataset for analysis
#create new variable with P and F values for VID_FACE (1= Partner, 2= Friend)
dataset1$relationship = ifelse(dataset1$VID_FACE==1, "P", "F")

#Merge in the AVO and ANX scores into the data
dataset3 = merge(dataset3, subset(dataset1, select=c("id1", "relationship", "AVO", "ANX", "ZAVO", "ZANX")), by.x=c("ID", "relationship"), by.y=c("id1", "relationship"))

```

> This model was a significant fit for the data, F(7, 30) = 19.25, p < 0.001. Inspection of the model parameters revealed a main effect of Relationship, F(1, 30) = 4.40, p = 0.044, whereby individuals showed significantly greater mimicry of their partners than they did their friends, controlling for differences in ANX and AVO attachment style (see Fig. 2).

Then run linear mixed effects model. 
```{r}
#to get the overall fit p value:
basemodel = lme(CE ~ 1, random = ~1|ID/relationship, data=dataset3, method="ML")
mle1 = lme(CE ~ relationship*ZANX*ZAVO, random= ~1|ID/relationship, data=dataset3, method="ML")
anova(basemodel, mle1)

#Parameter estimates
anova(mle1, type="marginal") #use Type III SS for comparison to SPSS
summary(mle1)

```

The authors used GENLINMIXED in SPSS, rather than the nlme mixed pagckage in R, so it is very likely that  differences seen here are due to the different ways each program calculates the model. 

However, there are some inconsistencies: 
* The reported denominator df are not the same as I see (30 reported versus 12 observed here). 
* Overall model "fit" is not reported in the lme output, but an approximation is calcualted using a model based on means. The comparison between this "baseline" model and the full model is similar to the reported finding that the model fit well
* relationship was right at significance, rather than highly significant 
* interaction between relationship and ZANX was not signficiant 
* Parameter estimates and t-values did not match up 

In order to determine whether I get the same result in SPSS using the procedure described, I wrote out the same da


## Step 5: Conclusion

```{r}
```

[Please also include a brief text summary describing your findings. If this reproducibility check was a failure, you should note any suggestions as to what you think the likely cause(s) might be.]

[This function will output information about the package versions used in this report:]

```{r session_info, include=TRUE, echo=TRUE, results='markup'}
devtools::session_info()
```
